<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Factulist – News Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4">Factulist – Fake News & Bias Detector</h1>

    <!-- Input Form -->
    <form id="analyze-form" enctype="multipart/form-data">
        <div class="mb-3">
            <label class="form-label">Enter Article URL</label>
            <input type="text" class="form-control" name="url" placeholder="https://example.com/news-article">
        </div>
        <div class="mb-3">
            <label class="form-label">Or Paste Raw Text</label>
            <textarea class="form-control" name="raw_text" rows="4"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">Or Upload File (PDF/DOCX)</label>
            <input type="file" class="form-control" name="file">
        </div>
        <button type="submit" class="btn btn-primary">Analyze</button>
        <a href="/history" class="btn btn-secondary">View History</a>
        <a href="/sources" class="btn btn-info">View Sources</a>
    </form>

    <!-- Report Section -->
    <div id="report-section" class="mt-5" style="display: none;">
        <h3>Credibility Report</h3>
        <div class="card p-3">
            <p><strong>Article Link:</strong> <span id="article_link"></span></p>
            <p><strong>Credibility Score:</strong> <span id="credibility_score"></span></p>
            <p><strong>Summary:</strong> <span id="summary"></span></p>
            <p><strong>Bias:</strong> <span id="bias"></span> (confidence: <span id="bias_confidence"></span>)</p>
            <p><strong>Recommendation:</strong> <span id="recommendation"></span></p>
            <p><strong>Source Analysis:</strong> <span id="source_analysis"></span></p>

            <!-- Corroborating Sources -->
            <div class="mt-3">
                <strong>Corroborating Sources:</strong>
                <div id="corroborating_sources" class="mt-2"></div>
            </div>

            <!-- Explainability -->
            <div class="mt-3">
                <strong>Top Influential Keywords:</strong>
                <ul id="explanation"></ul>
            </div>

            <!-- Export -->
            <div class="mt-3">
                <a id="download-pdf" class="btn btn-outline-dark" target="_blank">Download PDF Report</a>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById("analyze-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    const response = await fetch("/check", { method: "POST", body: formData });
    const data = await response.json();

    document.getElementById("report-section").style.display = "block";
    document.getElementById("article_link").textContent = data.article_link;
    document.getElementById("credibility_score").textContent = data.credibility_score;
    document.getElementById("summary").textContent = data.summary;
    document.getElementById("bias").textContent = data.bias;
    document.getElementById("bias_confidence").textContent = data.bias_confidence;
    document.getElementById("recommendation").textContent = data.recommendation;
    document.getElementById("source_analysis").textContent = data.source_analysis;

    // Corroborating sources as clickable buttons
    const sourcesDiv = document.getElementById("corroborating_sources");
    sourcesDiv.innerHTML = "";
    if (data.corroborating_sources && data.corroborating_sources.length > 0) {
        data.corroborating_sources.forEach(src => {
            const a = document.createElement("a");
            a.href = src;
            a.textContent = src;
            a.target = "_blank";
            a.className = "btn btn-sm btn-outline-primary me-2 mb-2";
            sourcesDiv.appendChild(a);
        });
    }

    // Explainability keywords
    const expList = document.getElementById("explanation");
    expList.innerHTML = "";
    if (data.explanation && data.explanation.length > 0) {
        data.explanation.forEach(item => {
            const li = document.createElement("li");
            li.textContent = `${item[0]} (score: ${item[1].toFixed(2)}, label: ${item[2]})`;
            expList.appendChild(li);
        });
    }

    // PDF download link
    document.getElementById("download-pdf").href = "/export/report/" + (data.id || 0) + "/pdf";
});
</script>
</body>
</html>
